{namespace neos=TYPO3\Neos\ViewHelpers}

<div class="google-map-canvas" data-map-id="{node.identifier}" data-type="{type}" data-draggable="{draggable}" data-scrollwheel="{scrollwheel}" data-map-type-control="{mapTypeControl}" data-zoom-control="{zoomControl}" data-street-view-control="{streetViewControl}" data-lat="{lat}" data-lng="{lng}" data-zoom="{zoom}" data-fit-bounds="{fitBounds}" data-markers="<f:format.raw>{</f:format.raw>'markers':[<f:for each="{markers}" as="marker" iteration="iterator"><f:format.raw>{</f:format.raw>'m{iterator.index}':[<f:format.raw>{</f:format.raw>'street':'{marker.properties.street}','zip':'{marker.properties.zip}','city':'{marker.properties.city}','country':'{marker.properties.country}','title':'{marker.properties.title}','text':'<f:format.nl2br>{marker.properties.text}</f:format.nl2br>'<f:format.raw>}</f:format.raw>]<f:format.raw>}</f:format.raw><f:if condition="{iterator.isLast}"><f:then></f:then><f:else>,</f:else></f:if></f:for>]<f:format.raw>}</f:format.raw>" style="height: {height}px;"></div>

<f:security.ifAuthenticated>
    <div class="hidden">{markerCollection -> f:format.raw()}</div>
</f:security.ifAuthenticated>